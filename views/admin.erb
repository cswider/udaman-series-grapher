<!DOCTYPE html>

<html>
	
	<div id="wrap">
	
	<head>
		
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1.0">
	
	<!-- IMPORTS -->
	<link rel="stylesheet" href="/bootstrap/bootstrap-responsive.css">
	<link rel="stylesheet" href="/bootstrap/bootstrap.css">
	<script language="javascript" src="/bootstrap/bootstrap.js"></script>
	<script language="javascript" src="/jquery.js"></script>
	<title>Udaman Series Grapher</title>
	<script src="../../d3.v3.min.js"></script>
	<script src="../../d3.layout.js"></script>
	<script src="../../rickshaw.min.js"></script>
	
	<style>
					#chart_container {
					        position: relative;
					        font-family: Arial, Helvetica, sans-serif;
					}
					#chart {
					        position: relative;
					        left: 40px;
					        background: white;
					}
					.rickshaw_graph .y_ticks {
					        left: 0;
					}
					#y_axis {
					        position: absolute;
					        top: -424px;
					        bottom: 0;
					        width: 40px;
					        margin-left: 5px;
					        z-index: 9999999;
					}

					.rickshaw_graph .detail {
						pointer-events: none;
						position: absolute;
						top: 0;
						z-index: 2;
						background: rgba(0, 0, 0, 0.1);
						bottom: 0;
						width: 1px;
						transition: opacity 0.25s linear;
						-moz-transition: opacity 0.25s linear;
						-o-transition: opacity 0.25s linear;
						-webkit-transition: opacity 0.25s linear;
						margin-left: 4px;
					}
					.rickshaw_graph .detail.inactive {
						opacity: 0;
					}
					.rickshaw_graph .detail .item.active {
						opacity: 1;
					}
					/*
					.rickshaw_graph .detail .x_label {
						font-family: Arial, sans-serif;
						border-radius: 3px;
						padding: 6px;
						opacity: 0.5;
						border: 1px solid #e0e0e0;
						font-size: 12px;
						position: absolute;
						background: grey;
						white-space: nowrap;
					}
					*/
					.rickshaw_graph .detail .item {
						position: absolute;
						z-index: 2;
						border-radius: 3px;
						padding: 0.25em;
						font-size: 12px;
						font-family: Arial, sans-serif;
						opacity: 0;
						background: rgba(0, 0, 0, 0.4);
						color: white;
						border: 1px solid rgba(0, 0, 0, 0.4);
						margin-left: 1em;
						margin-top: 0em;
						white-space: nowrap;
					}
					.rickshaw_graph .detail .item.active {
						opacity: 1;
						background: rgba(0, 0, 0, 0.8);
					}
					.rickshaw_graph .detail .item:before {
						content: "\25c2";
						position: absolute;
						left: -0.5em;
						color: rgba(0, 0, 0, 0.7);
						width: 0;
					}
					.rickshaw_graph .detail .dot {
						width: 4px;
						height: 4px;
						margin-left: -4px;
						margin-top: 9px;
						border-radius: 5px;
						position: absolute;
						box-shadow: 0 0 2px rgba(0, 0, 0, 0.6);
						background: white;
						border-width: 2px;
						border-style: solid;
						display: none;
						background-clip: padding-box;
					}
					.rickshaw_graph .detail .dot.active {
						display: block;
					}
					/* graph */

					.rickshaw_graph {
						position: relative;
					}
					.rickshaw_graph svg {
						display: block;	
						overflow: hidden;
					}

					/* ticks */

					.rickshaw_graph .x_tick {
						position: absolute;
						top: 0;
						bottom: 0;
						width: 0px;
						border-left: 1px dotted rgba(0, 0, 0, 0.2);
						pointer-events: none;
					}
					.rickshaw_graph .x_tick .title {
						position: absolute;
						font-size: 12px;
						font-family: Arial, sans-serif;
						opacity: 0.5;
						white-space: nowrap;
						margin-left: 3px;
						bottom: 1px;
					}

					/* annotations */

					.rickshaw_annotation_timeline {
						height: 1px;
						border-top: 1px solid #e0e0e0;
						margin-top: 10px;
						position: relative;
					}
					.rickshaw_annotation_timeline .annotation {
						position: absolute;
						height: 6px;
						width: 6px;
						margin-left: -2px;
						top: -3px;
						border-radius: 5px;
						background-color: rgba(0, 0, 0, 0.25);
					}
					.rickshaw_graph .annotation_line {
						position: absolute;
						top: 0;
						bottom: -6px;
						width: 0px;
						border-left: 2px solid rgba(0, 0, 0, 0.3);
						display: none;
					}
					.rickshaw_graph .annotation_line.active {
						display: block;
					}

					.rickshaw_graph .annotation_range {
					        background: rgba(0, 0, 0, 0.1);
					        display: none;
					        position: absolute;
					        top: 0;
					        bottom: -6px;
					}
					.rickshaw_graph .annotation_range.active {
					        display: block;
					}
					.rickshaw_graph .annotation_range.active.offscreen {
					        display: none;
					}






					.rickshaw_annotation_timeline .annotation .content {
						background: white;
						color: black;
						opacity: 0.9;
						padding: 5px 5px;
						box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
						border-radius: 3px;
						position: relative;
						z-index: 20;
						font-size: 12px;
						padding: 6px 8px 8px;
						top: 18px;
						left: -11px;
						width: 160px;
						display: none;
						cursor: pointer;
					}
					.rickshaw_annotation_timeline .annotation .content:before {
						content: "\25b2";
						position: absolute;
						top: -11px;
						color: white;
						text-shadow: 0 -1px 1px rgba(0, 0, 0, 0.8);
					}
					.rickshaw_annotation_timeline .annotation.active,
					.rickshaw_annotation_timeline .annotation:hover {
						background-color: rgba(0, 0, 0, 0.8);
						cursor: none;
					}
					.rickshaw_annotation_timeline .annotation .content:hover {
						z-index: 50;
					}
					.rickshaw_annotation_timeline .annotation.active .content {
						display: block;
					}
					.rickshaw_annotation_timeline .annotation:hover .content {
						display: block;
						z-index: 50;
					}
					.rickshaw_graph .y_axis,
					.rickshaw_graph  .x_axis_d3 {
						fill: none;
					}
					.rickshaw_graph .y_ticks .tick,
					.rickshaw_graph .x_ticks_d3 .tick {
						stroke: rgba(0, 0, 0, 0.16);
						stroke-width: 2px;
						shape-rendering: crisp-edges;
						pointer-events: none;
					}
					.rickshaw_graph .y_grid .tick,
					.rickshaw_graph .x_grid_d3 .tick {
						z-index: -1;
						stroke: rgba(0, 0, 0, 0.20);
						stroke-width: 1px;
						stroke-dasharray: 1 1;
					}
					.rickshaw_graph .y_grid path,
					.rickshaw_graph .x_grid_d3 path  {
						fill: none;
						stroke: none;
					}
					.rickshaw_graph .y_ticks path,
					.rickshaw_graph .x_ticks_d3 path {
						fill: none;
						stroke: #808080;
					}
					.rickshaw_graph .y_ticks text,
					.rickshaw_graph .x_ticks_d3 text {
						opacity: 0.8;
						font-size: 12px;
						pointer-events: none;
					}
					.rickshaw_graph .x_tick.glow .title,
					.rickshaw_graph .y_ticks.glow text {
						fill: black;
						color: black;
						text-shadow: 
							-1px 1px 0 rgba(255, 255, 255, 0.1),
							1px -1px 0 rgba(255, 255, 255, 0.1),
							1px 1px 0 rgba(255, 255, 255, 0.1),
							0px 1px 0 rgba(255, 255, 255, 0.1),
							0px -1px 0 rgba(255, 255, 255, 0.1),
							1px 0px 0 rgba(255, 255, 255, 0.1),
							-1px 0px 0 rgba(255, 255, 255, 0.1),
							-1px -1px 0 rgba(255, 255, 255, 0.1);
					}
					.rickshaw_graph .x_tick.inverse .title,
					.rickshaw_graph .y_ticks.inverse text {
						fill: white;
						color: white;
						text-shadow: 
							-1px 1px 0 rgba(0, 0, 0, 0.8),
							1px -1px 0 rgba(0, 0, 0, 0.8),
							1px 1px 0 rgba(0, 0, 0, 0.8),
							0px 1px 0 rgba(0, 0, 0, 0.8),
							0px -1px 0 rgba(0, 0, 0, 0.8),
							1px 0px 0 rgba(0, 0, 0, 0.8),
							-1px 0px 0 rgba(0, 0, 0, 0.8),
							-1px -1px 0 rgba(0, 0, 0, 0.8);
					}
					.rickshaw_legend {
						font-family: Arial;
						font-size: 12px;
						color: white;
						display: inline-block;
						padding: 12px 5px; 
						border-radius: 2px;
						position: relative;
					}
					.rickshaw_legend:hover {
						z-index: 10;
					}
					.rickshaw_legend .swatch {
						width: 10px;
						height: 10px;
						border: 1px solid rgba(0, 0, 0, 0.2);
					}
					.rickshaw_legend .line {
						clear: both;
						line-height: 140%;
						padding-right: 15px;
						margin-left: -99999px;
					}
					/*.rickshaw_legend .line .swatch {
						display: inline-block;
						margin-right: 3px;
						border-radius: 2px;
						margin-left: -99999px;
					}*/
					/*.rickshaw_legend .label {
						margin: 0;
						white-space: nowrap;
						display: inline;
						font-size: inherit;
						background-color: transparent;
						color: inherit;
						font-weight: normal;
						line-height: normal;
						padding: 0px;
						text-shadow: none;
						margin-left: -99999px;
					}*/
					.rickshaw_legend .action:hover {
						opacity: 0.6;
					}
					.rickshaw_legend .action {
						margin-right: 0.2em;
						font-size: 10px;
						opacity: 0.2;
						cursor: pointer;
						font-size: 14px;
						margin-left: -9999px;
					}
					.rickshaw_legend .line.disabled {
						opacity: 0.4;
					}
					/*.rickshaw_legend ul {
						list-style-type: none;
					  	margin: 0;
						padding: 3px;
						cursor: pointer;
						position: absolute;
						background: #404040;
						top: 50%;
						right: -120px;
						border-radius: 2px;
					}*/
					.rickshaw_legend li {
						padding: 0 0 0 2px;
						min-width: 80px;
						white-space: nowrap;
					}
					.rickshaw_legend li:hover {
						background: rgba(255, 255, 255, 0.08);
						border-radius: 3px;
					}
					.rickshaw_legend li:active {
						background: rgba(255, 255, 255, 0.2);
						border-radius: 3px;
					}


					</style>
	
	</head>

	<body>
		
		<!-- NAVBAR -->
		<div class="navbar navbar-inverse navbar-fixed-top" align="left">
	      <div class="navbar-inner">
	        <div class="container">
	          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	            <span class="icon-bar"></span>
	          </button>
	          <a class="brand" href="/">Udaman Series Grapher</a>
	          <div class="nav-collapse collapse">
	            <ul class="nav pull-right">
	              <li ><a href="/">Home</a></li>
				  <li class="active"><a href="/admin">Admin</a></li>
				  <li><a href="/admin/add">Add an Admin</a></li>
				  <li><a href="/logout">Logout</a></li>
	            </ul>
	          </div>
	        </div>
	      </div>
		</div>
		
		<!-- SPACER -->
		<div class="container" id="spacer">
			<div class="row">
				<div class="span12">
					<p>
						<br>
						<br>
						<br>
					</p>
				</div>
			</div>
		</div>
		
		
		<div class="row-fluid">
			<div class="span5">
				<div class="row-fluid">
					<div class="span12 well container-narrow">
						<h3>Cache a Series</h3>
						<div class="span12 container-narrow">
							<form method="post" action='/admin/cache'>
								<input type="text" name="seriesNumber"/>
								<br>
								<input type="submit" value="Cache" class="btn"/>
							</form>
						</div>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span12 well container-narrow">
						<div class="row-fluid">
							<div class="span6">
								<h3>Series Requests</h3>
								<p>Requested series.</p>
							</div>
							<div class="span6">
								<div align="right">
									<form method="post" action="/clearrequests">
										<input type="submit" value="Clear All" class="btn">
									</form>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<ul name="requestList">
								<%if !@all_requests.nil?%>
								<%@all_requests.each do |a|%>
								<li><%=a.series%>&nbsp;&nbsp;<a href="/admin/cacherequest/<%=a.series%>">Cache It</a> | <a href="/deleterequest/<%=a.series%>">Delete</a></li>
								<%end%>
								<%end%>
							</ul>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span12 well container-narrow">
						<div class="row-fluid">
							<div class="span6">
								<h3>Cached Series</h3>
							</div>
							<div class="span6">
								<div align="right">
									<form method = "post" action = "/clear">
										<input type = "submit" value = "Clear All" class = "btn"/>
									</form>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<ul name="seriesList">
								<% if !@all_files.nil? %>
								<%@all_files.each do |a| %>
								<li><%=a.description%>&nbsp;&nbsp;<br>Frequency: <%=a.frequency.capitalize	%>&nbsp;<a href="/admin/graphview/<%=a.name%>" rel="alternate">Chart</a> | <a href="/json/<%=a.name%>">JSON Format</a> | <a href="/delete/<%=a.name%>">Delete</a></li>
								<%end%>
								<%end%>
							</ul>
						</div>
					</div>
				</div>
			</div>
			</div>
			<div class="span7">
				<div class="row-fluid">
					<div class="span12 well container-narrow">
						<div id="chart_container">
						        <div id="y_axis"></div>
						        <div id="chart"></div>
						</div>
						<p>
							<br>
						</p>
						<a class="btn" href = "/embed/<%=@name%>">Embed this chart</a>
						<script>

						var palette = new Rickshaw.Color.Palette( { scheme: 'spectrum2000' } );

						var graph = new Rickshaw.Graph( {
						        element: document.querySelector("#chart"),
						        width: 760,
						        height: 360,
						        renderer: 'line',
						        series: [{
									name: 'Data',
									data: [{ x: 0, y: 0 },],
								color: "blue",
							}]
						} );


						/*var shelving = new Rickshaw.Graph.Behavior.Series.Toggle({
						    graph: graph,
						    legend: legend
						});
						*/

						var xTemp;

						var xarray = new Array();


						
						xarray.push("0");
						


						var hoverDetail = new Rickshaw.Graph.HoverDetail( {
						    graph: graph,
						    xFormatter: function(x) { xTemp = xarray[x]; return "" },
						    yFormatter: function(y) { return Math.floor(y) + "<br>" + "Date: " + xTemp }
						} );

						var yAxis = new Rickshaw.Graph.Axis.Y({
						    graph: graph
						});


						var xAxis = new Rickshaw.Graph.Axis.X({
						    graph: graph,
							tickFormat: function(x) {return xarray[x]}
						});


						graph.render();

						</script>
					</div>
				</div>
				<div class="row-fluid">
					<h3>JSON Source</h3>
					<p><%=@cached_json%></p>
				</div>
			</div>
		</div>
		
		<style type="text/css">

		         /* Sticky footer styles
		         -------------------------------------------------- */

		         html,
		         body {
		           height: 100%;
		           /* The html and body elements cannot have any padding or margin. */
		         }

		         /* Wrapper for page content to push down footer */
		         #wrap {
		           min-height: 100%;
		           height: auto !important;
		           height: 100%;
		           /* Negative indent footer by it's height */
		           margin: 0 auto -60px;
		         }

		         /* Set the fixed height of the footer here */
		         #push,
		         #footer {
		           height: 60px;
		         }
		         #footer {
		           background-color: #f5f5f5;
		         }

		         /* Lastly, apply responsive CSS fixes as necessary */
		         @media (max-width: 767px) {
		           #footer {
		             margin-left: -20px;
		             margin-right: -20px;
		             padding-left: 20px;
		             padding-right: 20px;
		           }
		         }
		
				 .container .credit {
				           margin: 20px 0;
				         }

		       </style>
		</body>
		
		</div>
		
	<div id="footer">
		<div class="container">
	    	<center><p class="muted credit">This page was created by Connor Douglas and Derek Renusch for the UHERO Network</p></center>
		</div>
	</div>
		
		
</html>